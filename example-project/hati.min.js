export function initialize(t){getAnchors(t).forEach(e=>{e.addEventListener("click",n=>{dispatchBeforeLoadEvent(e),changeUrl(e),tryLoadContent(n,e,t)})})}export function getAnchors(t){return t.querySelectorAll('a[data-target-id]:not([data-target-id=""])')}function dispatchBeforeLoadEvent(t){const e=new CustomEvent("hati:beforeLoad",{bubbles:!0,cancelable:!0,detail:{href:t.href}});t.dispatchEvent(e)}function changeUrl(t){history.pushState({},null,t.href)}async function tryLoadContent(t,e,n){t.preventDefault();const a=getTargetElement(e,n);a?doLoadContent(e,a):handleError(e)}function getTargetElement(t,e){const n=t.getAttribute("data-target-id");return e.querySelector(`#${n}`)}async function doLoadContent(t,e){const n=await fetchContent(t);renderContentInTargetElement(e,n.content),initialize(e),dispatchContentLoadedEvent(e,{href:t.href,responseStatusCode:n.statusCode})}async function fetchContent(t){let e=await fetch(t.href);return{content:await e.text(),statusCode:e.status}}function renderContentInTargetElement(t,e){clearTargetElement(t),t.insertAdjacentHTML("afterbegin",e)}function clearTargetElement(t){for(;t.lastChild;)t.removeChild(t.lastChild)}function dispatchContentLoadedEvent(t,e){const n=new CustomEvent("hati:DOMContentLoaded",{bubbles:!0,cancelable:!0,detail:e});t.dispatchEvent(n)}function handleError(t){const e=`No element found with id: ${t.getAttribute("data-target-id")}`,n=new CustomEvent("hati:error",{bubbles:!0,cancelable:!0,detail:{href:t.href,errorMessage:e}});return t.dispatchEvent(n),console.error(e)}
